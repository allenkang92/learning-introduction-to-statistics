# 데이터 입력
# 16명의 학생 점수 데이터
score = c(88, 83, 83, 85, 94, 88, 91, 96, 89, 83, 81, 80, 84, 89, 83, 79)

# 표본평균과 표본표준편차 계산
# bar_x: 표본평균 - 모든 점수의 합을 개수로 나눈 값
# s: 표본표준편차 - 분산의 제곱근
# n: 표본 크기 - 데이터의 개수
bar_x = mean(score); s = sd(score); n = length(score)

# 모평균의 95% 신뢰구간 구하기
# qt() 함수: t-분포의 백분위수(quantile)를 계산
# qt(0.975, 15): 자유도가 15(n-1)인 t-분포에서 상위 2.5% 지점의 값
# 95% 신뢰구간은 양쪽 끝에서 각각 2.5%씩 제외한 구간
qt(0.975, 15)  # t-분포의 97.5 백분위수 (상위 2.5% 지점)

# lower.tail = FALSE 옵션은 오른쪽 꼬리 확률을 사용
# qt(0.025, 15, lower.tail = FALSE)는 qt(0.975, 15)와 동일한 결과
qt(0.025, 15, lower.tail = FALSE)  # 위와 동일한 값

# 95% 신뢰구간 계산을 위한 t값 저장
qt_95 = qt(0.975, 15)

# 모평균의 95% 신뢰구간 계산
# 공식: 표본평균 ± (t값 × 표본표준편차/√표본크기)
# 이 구간은 모평균이 95% 확률로 포함되어 있다고 해석
c(bar_x - qt_95 * s / sqrt(n), bar_x + qt_95 * s / sqrt(n))  # 신뢰구간의 하한값과 상한값

# t.test() 함수를 사용한 95% 신뢰구간 계산 (기본값이 95% 신뢰수준)
# $conf.int는 t.test() 결과에서 신뢰구간 부분만 추출
# 위에서 직접 계산한 결과와 동일한 값이 나옴
t.test(score)$conf.int  # t.test 함수로 계산한 신뢰구간

#-------------------------------------------------------
# 모비율의 95% 신뢰구간 계산
#-------------------------------------------------------

# 모비율 신뢰구간 예제 데이터
# n: 표본 크기 (총 500명)
# X: 성공 횟수 (200명이 '성공'한 경우)
n = 500; X = 200

# 표본비율(p_hat) 계산: 성공 횟수/표본 크기
p_hat = X / n  # 200/500 = 0.4 (40%)

# 유의수준 설정 (95% 신뢰구간이므로 α = 0.05)
alpha = 0.05

# 표준정규분포의 임계값 계산
# qnorm(): 정규분포의 백분위수 함수
# 1 - alpha/2 = 0.975 (97.5%)에 해당하는 z값 (약 1.96)
z_1 = qnorm(1 - alpha / 2)

# 모비율의 95% 신뢰구간 계산
# 공식: 표본비율 ± z × √(표본비율 × (1-표본비율) / 표본크기)
# 이 구간은 모비율이 95% 확률로 포함되어 있다고 해석
c(p_hat - z_1 * sqrt(p_hat * (1 - p_hat) / n), 
  p_hat + z_1 * sqrt(p_hat * (1 - p_hat) / n))  # 신뢰구간의 하한값과 상한값

# prop.test() 함수를 사용한 95% 신뢰구간 계산
# X: 성공 횟수, n: 시행 횟수
# $conf.int는 prop.test() 결과에서 신뢰구간 부분만 추출
# 위에서 직접 계산한 결과와 유사한 값이 나옴 (약간의 차이는 연속성 보정 때문)
prop.test(X, n)$conf.int  # prop.test 함수로 계산한 신뢰구간

#-------------------------------------------------------
# 모분산의 95% 신뢰구간 계산
#-------------------------------------------------------

# 모분산 신뢰구간 예제 데이터
# s2: 표본분산 (표준편차 4의 제곱)
# n: 표본 크기 (40개)
s2 = 4^2  # 표본분산 = 16
n = 40    # 표본 크기

# 유의수준 설정 (95% 신뢰구간이므로 α = 0.05)
alpha = 0.05

# 카이제곱분포의 임계값 계산
# qchisq(): 카이제곱분포의 백분위수 함수
# 1 - alpha/2 = 0.975 (97.5%)에 해당하는 상위 임계값
q_1 = qchisq(1 - alpha / 2, n - 1)  # 상위 2.5% 지점의 카이제곱값

# alpha/2 = 0.025 (2.5%)에 해당하는 하위 임계값
q_2 = qchisq(alpha / 2, n - 1)  # 하위 2.5% 지점의 카이제곱값

# 모분산의 95% 신뢰구간 계산
# 공식: ((n-1) × s²/χ²₁, (n-1) × s²/χ²₂)
# 주의: 모분산 신뢰구간은 다른 신뢰구간과 달리 상한과 하한의 계산식이 서로 다름
# 이 구간은 모분산이 95% 확률로 포함되어 있다고 해석
c((n - 1) * s2 / q_1, (n - 1) * s2 / q_2)  # 신뢰구간의 하한값과 상한값

# 모표준편차의 95% 신뢰구간 (모분산의 신뢰구간에 제곱근을 취함)
sqrt(c((n - 1) * s2 / q_1, (n - 1) * s2 / q_2))  # 표준편차 신뢰구간