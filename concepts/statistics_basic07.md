## 통계적 비교 I

**I. 두 모집단의 비교**

1. **비교의 필요성 및 사례:**
    - 실생활/비즈니스에서 두 집단 간 차이(선호도, 수율, 효과 등)를 비교해야 하는 경우 빈번.
    - 주로 각 모집단의 **평균(μ) 또는 분산(σ²)**을 비교하는 문제로 귀결됨.
2. **두 모평균(μ₁, μ₂) 비교:**
    - **표본 유형:**
        - **독립 표본 (Independent Samples):** 두 집단에서 표본을 서로 독립적으로 추출. (예: 제품 A 사용자 그룹 vs 제품 B 사용자 그룹).
        - **대응 표본 (Paired/Dependent Samples):** 동일한 개체에 대해 두 가지 조건에서 측정하거나, 특성이 유사한 개체끼리 짝지어 비교. (예: 직무연수 전/후 직무능력 점수).
    - **가설 설정:** 비교 기준 값(δ₀, 보통 0)을 이용하여 귀무가설(H₀)과 대립가설(H₁) 설정.
        - `H₀: μ₁ - μ₂ = δ₀` (두 모평균의 차이는 δ₀이다)
        - `H₁: μ₁ - μ₂ ≠ δ₀` (양측 검정) or `μ₁ - μ₂ > δ₀` (우측 검정) or `μ₁ - μ₂ < δ₀` (좌측 검정).
    - **독립표본 검정 방법:**
        - **표본 수가 충분히 큰 경우 (n₁, n₂ > 30): Z-검정**
            - 모집단 분포 무관 (중심극한정리).
            - 검정통계량: `Z = [(X̄₁ - X̄₂) - δ₀] / √[(S₁²/n₁) + (S₂²/n₂)]` (σ₁, σ₂ 모를 때 S₁, S₂ 사용).
            - 표준정규분포 `N(0, 1)` 이용 검정.
        - **표본 수가 작은 경우 (n₁, n₂ ≤ 30): t-검정** (모집단 정규분포 가정 필요)
            - **두 모분산이 같은 경우 (σ₁² = σ₂²): 합동 분산(Pooled Variance) t-검정**
                - 합동 표본분산 `S<0xE1><0xB5><0x83>²` 계산.
                - 검정통계량: `T = [(X̄₁ - X̄₂) - δ₀] / [S<0xE1><0xB5><0x83> * √(1/n₁ + 1/n₂)]`.
                - 자유도 `df = n₁ + n₂ - 2`인 t-분포 이용 검정.
            - **두 모분산이 다른 경우 (σ₁² ≠ σ₂²): Welch의 t-검정**
                - 검정통계량: `T = [(X̄₁ - X̄₂) - δ₀] / √[(S₁²/n₁) + (S₂²/n₂)]`.
                - 자유도 `df`는 근사식(Satterthwaite)으로 계산. t-분포 이용 검정.
    - **대응표본 검정 방법:**
        - **핵심:** 각 쌍(pair)의 **차이(Difference, D = X_before - X_after 등)**를 계산.
        - **단일 표본 문제로 변환:** 차이값(D)들의 평균(μ<0xE1><0xB5><0x83>)에 대한 가설검정 수행.
        - `H₀: μ<0xE1><0xB5><0x83> = δ₀` (보통 0).
        - 검정통계량: `T = (D̄ - δ₀) / (S<0xE1><0xB5><0x83> / √n)` (n은 쌍의 개수).
        - 자유도 `df = n - 1`인 t-분포 이용 검정.
3. **두 모분산(σ₁², σ₂²) 비교:**
    - **목적:** 두 모집단의 퍼짐 정도(분산)가 같은지 비교. (독립표본 t-검정 전 가정 확인 등).
    - **가설 설정:** `H₀: σ₁² = σ₂²` vs. `H₁: σ₁² ≠ σ₂²` (또는 >, <).
    - **검정통계량: F-통계량**
        - `F = S₁² / S₂²` (두 표본분산의 비율).
    - **분포:** 귀무가설 하에서 분자 자유도 `df₁ = n₁ - 1`, 분모 자유도 `df₂ = n₂ - 1`인 **F-분포 (`F(n₁-1, n₂-1)`)**를 따름.
    - **검정:** 계산된 F값과 해당 자유도, 유의수준 α에서의 임곗값을 비교하여 H₀ 기각 여부 결정.

**II. 다수 모집단의 비교 (분산분석 - ANOVA)**

1. **분산분석(ANOVA)의 원리:**
    - **목적:** **셋 이상**의 모집단 평균들이 모두 같은지 비교 (예: `H₀: μ₁ = μ₂ = μ₃`).
    - **핵심 아이디어:** 전체 데이터의 **총 변동(Total Variation)**을 **집단 간 변동(Between-group Variation)**과 **집단 내 변동(Within-group Variation)**으로 분해.
        - **집단 간 변동:** 각 집단 평균들이 전체 평균과 얼마나 다른가? (처리 효과, 요인 효과).
        - **집단 내 변동:** 각 집단 내 데이터들이 그 집단 평균과 얼마나 다른가? (오차, 우연 변동).
    - **F-검정:** `F = (집단 간 변동 / 집단 간 자유도) / (집단 내 변동 / 집단 내 자유도) = MS_Between / MS_Within`.
        - F값이 크다는 것 = 집단 내 변동에 비해 집단 간 변동이 상대적으로 크다 → 집단 간 평균 차이가 유의미할 가능성 높음 → H₀ 기각.
    - **가정:** 정규성, 독립성, **등분산성(Equal Variances)**.
2. **일원배치법 (One-Way ANOVA):**
    - **상황:** **하나의 요인(Factor)**에 따른 여러 수준(Level)/그룹 간 평균 비교. (예: 비료 종류(요인 A)에 따른 수확량 평균 비교).
    - **데이터 배열:** 요인의 수준별로 데이터를 나열.
    - **가설:** `H₀: μ₁ = μ₂ = ... = μ<0xE2><0x84><0x93>` vs. `H₁: 모든 μᵢ가 같지는 않다`.
    - **분산분석표 (ANOVA Table):**
        - **구성:** 변동 요인(Factor A, Error, Total), 제곱합(SSA, SSE, SST), 자유도(dfA, dfE, dfT), 평균제곱(MSA=SSA/dfA, MSE=SSE/dfE), F 통계량(F=MSA/MSE).
        - **검정:** 계산된 F값과 `F(dfA, dfE; α)` 임곗값 비교.
    - **사후 분석 (Post-Hoc Analysis) / 다중 비교 (Multiple Comparisons):**
        - ANOVA F-검정에서 H₀ 기각 시, **어떤 집단 간** 평균 차이가 유의한지 파악.
        - **Fisher's LSD:** 최소유의차(LSD) 계산 후, 두 집단 평균 차의 절댓값과 비교.
3. **이원배치법 (Two-Way ANOVA):**
    - **상황:** **두 개의 요인(Factor A, Factor B)**이 반응값에 미치는 영향 및 두 요인 간 **상호작용 효과(Interaction Effect)** 분석. (예: 비료 종류(A)와 토양 종류(B)에 따른 수확량 평균 비교).
    - **데이터 배열:** 요인 A, B의 수준 조합에 따른 데이터 배열.
    - **분산분석표 (반복 없는 경우):** 총 변동을 요인 A, 요인 B, 오차(Error)로 분해. 각 요인에 대한 F 통계량 계산.
    - **가설:** 각 요인별 주효과(Main Effect)에 대한 가설 설정.
        - `H₀(A): α₁ = α₂ = ... = 0` (요인 A의 수준 간 평균 차이 없다).
        - `H₀(B): β₁ = β₂ = ... = 0` (요인 B의 수준 간 평균 차이 없다).
    - **검정:** 각 요인별 F값과 해당 임곗값 비교하여 귀무가설 기각 여부 판단.
    - **추정:** 각 요인 수준별 모평균 추정 및 신뢰구간 계산 가능.

**III. R을 이용한 실습 (함수 소개)**

- **두 모평균 비교 (t-검정):** `t.test()` 함수.
    - `t.test(y1, y2, paired = TRUE/FALSE, alternative = "two.sided"/"less"/"greater", var.equal = TRUE/FALSE, mu = diff)`
        - `paired=T`: 대응표본 t-검정.
        - `alternative`: 대립가설 형태 지정.
        - `var.equal=T`: 등분산 가정 시 (Pooled). `F`이면 Welch 검정(기본값).
        - `mu`: 귀무가설에서의 평균 차이 (기본값 0).
- **분산분석 (ANOVA):** `aov()` 함수.
    - `aov_model <- aov(종속변수 ~ 독립변수1 + 독립변수2 + ..., data = 데이터프레임)`
    - 독립변수(요인)는 `factor()` 함수로 범주형 처리 필요.
    - `summary(aov_model)`: 분산분석표 결과 출력.

**핵심 요약:**

- 두 집단의 평균 비교 시 **표본의 독립성/대응성, 표본 크기, 분산 동일성 가정** 여부에 따라 **Z-검정, t-검정(Pooled or Welch's), 대응표본 t-검정** 중 적절한 방법을 선택해야 합니다.
- 두 집단의 분산 비교는 **F-검정**을 사용합니다.
- 셋 이상의 집단 평균 비교에는 **분산분석(ANOVA)**을 사용하며, 이는 전체 변동을 **집단 간 변동**과 **집단 내 변동**으로 분해하여 비교하는 원리입니다.
- **일원배치법**은 하나의 요인 효과를, **이원배치법**은 두 개 요인의 주효과 (및 상호작용 효과)를 검정합니다.
- ANOVA에서 귀무가설 기각 시, **사후 분석(다중 비교)**을 통해 구체적으로 어떤 집단 간 차이가 있는지 파악해야 합니다.
- R에서는 `t.test()`와 `aov()` 함수 등을 이용하여 이러한 통계적 비교를 쉽게 수행할 수 있습니다.

## 통계적 비교 II

**I. 분할표 (Contingency Table)**

1. **범주형 데이터 분석 개요:**
    - 변수의 값들이 특정 **범주(Category)**에 속하는 데이터를 분석.
    - 각 범주에 속하는 **도수(Frequency)**를 조사하여 분석.
    - **분할표:** 변수들의 범주 조합에 따른 도수를 표 형태로 나타낸 것. 데이터 분포 시각화 및 분석 기초 자료.
2. **분할표 종류:**
    - **일원 분할표 (One-way Table):** **하나**의 범주형 변수에 대한 도수분포표. (예: 혈액형별 학생 수).
    - **이원 분할표 (Two-way Table):** **두** 개의 범주형 변수 간의 관계를 보기 위한 교차표 (r x c 형태). (예: 학과(Stat/DS)와 등록여부(Y/N) 간의 관계).

**II. 독립성 검정 (Test of Independence)**

1. **목적:** **두 범주형 변수가 서로 관련이 있는지(종속적인지) 또는 관련이 없는지(독립적인지)** 검정.
2. **데이터:** 이원 분할표 (r x c table) 사용.
3. **가설 설정:**
    - **귀무가설 (H₀):** 두 변수는 서로 **독립**이다. (특정 범주 조합에 속할 확률 Pᵢⱼ = 각 변수의 주변 확률 곱 Pᵢ. * P.ⱼ).
    - **대립가설 (H₁):** 두 변수는 서로 **독립이 아니다 (종속이다)**.
4. **검정통계량: 카이제곱(χ²) 통계량**
    - **계산 원리:** 각 셀(범주 조합)에서의 **관찰도수(Observed, Oᵢⱼ)**와 귀무가설 하에서의 **기대도수(Expected, Eᵢⱼ)** 간의 차이를 측정.
    - **기대도수 계산:** `Eᵢⱼ = (i행 합계 * j열 합계) / 전체 총합`.
    - **χ² 통계량:** `χ² = Σ [ (Oᵢⱼ - Eᵢⱼ)² / Eᵢⱼ ]` (모든 셀에 대해 합산).
    - **해석:** 관찰도수와 기대도수의 차이가 클수록 χ² 값은 커짐 → H₀ 기각 가능성 높아짐.
5. **검정 방법:**
    - **분포:** 귀무가설(H₀) 하에서 χ² 검정통계량은 근사적으로 자유도 `df = (r-1)(c-1)`인 **카이제곱 분포**를 따름.
    - **결정:**
        - 계산된 χ² 값이 기각역(χ² > χ²_(df, α))에 속하면 H₀ 기각.
        - 또는, P-value가 유의수준 α보다 작거나 같으면 H₀ 기각.
    - **가정 (중요):** **모든 셀의 기대도수가 충분히 커야 함** (일반적으로 5 이상 권장). 작을 경우 인접 범주 통합 고려.

**III. 적합도 검정 (Goodness-of-Fit Test)**

1. **목적:** 관찰된 표본 데이터의 분포가 **특정 이론적 확률분포(예: 균일분포, 이항분포, 포아송분포, 정규분포 등)를 잘 따르는지(적합한지)** 검정.
2. **데이터:** 일원 분할표 (또는 범주별 도수) 사용.
3. **가설 설정:**
    - **귀무가설 (H₀):** 모집단 분포는 **가정한 특정 이론 분포를 따른다** (P₁=P₁₀, P₂=P₂₀, ...).
    - **대립가설 (H₁):** 모집단 분포는 가정한 이론 분포를 **따르지 않는다**.
4. **검정통계량: 카이제곱(χ²) 통계량**
    - **계산 원리:** 각 범주에서의 **관찰도수(Observed, Oᵢ)**와 귀무가설 하에서의 **기대도수(Expected, Eᵢ)** 간의 차이 측정.
    - **기대도수 계산:** `Eᵢ = n * Pᵢ₀` (n: 총 표본 크기, Pᵢ₀: H₀ 하에서 i번째 범주의 이론적 확률).
    - **χ² 통계량:** `χ² = Σ [ (Oᵢ - Eᵢ)² / Eᵢ ]` (모든 k개 범주에 대해 합산).
5. **검정 방법:**
    - **분포:** 귀무가설(H₀) 하에서 χ² 검정통계량은 근사적으로 **카이제곱 분포**를 따름.
    - **자유도 (df):**
        - 이론 분포의 모수가 **미리 알려진 경우:** `df = k - 1` (k: 범주의 개수).
        - 이론 분포의 모수(`p`개)를 **표본 데이터로부터 추정한 경우:** `df = k - 1 - p`.
    - **결정:**
        - 계산된 χ² 값이 기각역(χ² > χ²_(df, α))에 속하면 H₀ 기각.
        - 또는, P-value가 유의수준 α보다 작거나 같으면 H₀ 기각.
    - **가정 (중요):** **모든 범주의 기대도수가 충분히 커야 함** (일반적으로 5 이상 권장). 작을 경우 인접 범주 통합 고려.

**IV. R을 이용한 실습**

1. **독립성 검정:**
    - **분할표 생성:** `xtabs(~ 변수1 + 변수2, data = 데이터프레임)` 함수 사용.
    - **카이제곱 검정:** `chisq.test(분할표객체, correct = F)` 함수 사용.
        - `correct = F`: 연속성 수정 안 함 (일반적으로 사용).
        - 결과 해석: P-value 확인하여 H₀ (독립이다) 기각 여부 판단.
2. **적합도 검정:**
    - **기대도수 계산:**
        - 이론적 확률(`hypothesized_probabilities`) 계산 (필요시 모수 추정 - 예: 포아송 분포 `dpois(x, lambda=표본평균m)`).
        - 확률 합이 1이 되도록 조정 필요 가능성.
        - 기대도수 `Eᵢ = n * Pᵢ₀` 계산.
    - **범주 병합 (필요시):** 기대도수가 5 미만인 범주를 인접 범주와 통합하여 관찰도수(`observed_counts`) 및 이론적 확률(`hypothesized_probabilities`) 재계산.
    - **카이제곱 검정:** `chisq.test(관찰도수벡터, p = 이론적확률벡터)` 함수 사용.
    - **결과 해석:** P-value 확인 (자유도 `k-1-p` 고려 필요 시 `qchisq()` 함수로 임계값과 비교). H₀ (이론 분포를 따른다) 기각 여부 판단.

**핵심 요약:**

- **범주형 데이터** 분석에는 **분할표**를 이용한 도수 분석이 기본입니다.
- **독립성 검정**은 두 범주형 변수 간의 **연관성 유무**를 판단하며, 이원 분할표와 카이제곱 통계량(자유도 (r-1)(c-1))을 사용합니다.
- **적합도 검정**은 관찰된 데이터 분포가 **특정 이론 분포와 일치하는지** 판단하며, 일원 분할표(또는 도수)와 카이제곱 통계량(자유도 k-1 또는 k-1-p)을 사용합니다.
- 두 검정 모두 **카이제곱(χ²) 검정통계량**(`Σ (관찰도수 - 기대도수)² / 기대도수`)을 핵심으로 사용하며, **기대도수가 5 이상**이어야 한다는 가정을 충족해야 합니다.
- R에서는 `xtabs()`로 분할표를 만들고 `chisq.test()` 함수로 두 검정을 편리하게 수행할 수 있습니다.